# æ ¡å›­å¢™é¡¹ç›®å¿«é€Ÿéƒ¨ç½²æ‘˜è¦

## ğŸš€ ä¸€é”®éƒ¨ç½²

### Linux/macOS ç³»ç»Ÿ
```bash
# 1. ä¸‹è½½éƒ¨ç½²è„šæœ¬
chmod +x scripts/deploy.sh

# 2. æ£€æŸ¥ç¯å¢ƒ
chmod +x scripts/check-environment.sh
./scripts/check-environment.sh

# 3. åˆå§‹åŒ–æ•°æ®åº“
chmod +x scripts/init-database.sh
./scripts/init-database.sh

# 4. æ‰§è¡Œéƒ¨ç½²
./scripts/deploy.sh
```

### Windows ç³»ç»Ÿ
```powershell
# ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡ŒPowerShell
Set-ExecutionPolicy Bypass -Scope Process
.\scripts\deploy-windows.ps1
```

## ğŸ“‹ éƒ¨ç½²æ¸…å•

### ç¯å¢ƒè¦æ±‚
- [ ] Node.js >= 18.0.0
- [ ] MySQL >= 8.0
- [ ] Redis >= 6.0
- [ ] Nginx >= 1.18
- [ ] PM2 è¿›ç¨‹ç®¡ç†å™¨

### é¡¹ç›®ç»„ä»¶
- [ ] **åç«¯æœåŠ¡**: Node.js + Express (ç«¯å£: 3000)
- [ ] **ç®¡ç†åå°**: Vue.js + Element Plus (é™æ€æ–‡ä»¶)
- [ ] **ç§»åŠ¨ç«¯**: uni-app (å¯æ„å»ºä¸ºH5/å°ç¨‹åº/APP)

## âš¡ å¿«é€Ÿé…ç½®

### 1. æ•°æ®åº“é…ç½®
```sql
CREATE DATABASE campus_community CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE USER 'campus_wall'@'localhost' IDENTIFIED BY 'your_password';
GRANT ALL PRIVILEGES ON campus_community.* TO 'campus_wall'@'localhost';
```

### 2. ç¯å¢ƒå˜é‡ (.env)
```env
NODE_ENV=production
PORT=3000
DB_HOST=localhost
DB_USER=campus_wall
DB_PASSWORD=your_password
DB_NAME=campus_community
REDIS_HOST=localhost
REDIS_PORT=6379
JWT_SECRET=your_jwt_secret
```

### 3. Nginx é…ç½®
```nginx
server {
    listen 80;
    server_name your-domain.com;
    root /var/www/campus-wall/admin-dist;
    
    location /api/ {
        proxy_pass http://localhost:3000;
    }
    
    location / {
        try_files $uri $uri/ /index.html;
    }
}
```

## ğŸ”§ å¸¸ç”¨å‘½ä»¤

### åç«¯ç®¡ç†
```bash
# å¯åŠ¨æœåŠ¡
pm2 start ecosystem.config.js --env production

# æŸ¥çœ‹çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—
pm2 logs

# é‡å¯æœåŠ¡
pm2 restart campus-wall-api

# åœæ­¢æœåŠ¡
pm2 stop campus-wall-api
```

### å‰ç«¯æ„å»º
```bash
# ç®¡ç†åå°
cd admin
npm install
npm run build

# ç§»åŠ¨ç«¯ (H5)
cd uni-APP
npm install
npm run build:h5
```

### æ•°æ®åº“ç®¡ç†
```bash
# å¤‡ä»½æ•°æ®åº“
mysqldump -u campus_wall -p campus_community > backup.sql

# æ¢å¤æ•°æ®åº“
mysql -u campus_wall -p campus_community < backup.sql

# è¿è¡Œè¿ç§»
cd server && npm run seed-data
```

## ğŸŒ è®¿é—®åœ°å€

- **ç®¡ç†åå°**: http://your-domain.com
- **APIæ¥å£**: http://your-domain.com/api
- **ç§»åŠ¨ç«¯H5**: http://your-domain.com/h5 (å¦‚å·²éƒ¨ç½²)

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç«¯å£å ç”¨**
   ```bash
   # æŸ¥çœ‹ç«¯å£å ç”¨
   netstat -tulpn | grep :3000
   # æ€æ­»è¿›ç¨‹
   kill -9 PID
   ```

2. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   ```bash
   # æ£€æŸ¥MySQLçŠ¶æ€
   systemctl status mysql
   # æµ‹è¯•è¿æ¥
   mysql -u campus_wall -p -h localhost
   ```

3. **Redisè¿æ¥å¤±è´¥**
   ```bash
   # æ£€æŸ¥RedisçŠ¶æ€
   systemctl status redis
   # æµ‹è¯•è¿æ¥
   redis-cli ping
   ```

4. **æƒé™é—®é¢˜**
   ```bash
   # è®¾ç½®æ­£ç¡®æƒé™
   chown -R www-data:www-data /var/www/campus-wall
   chmod -R 755 /var/www/campus-wall
   ```

### æ—¥å¿—æŸ¥çœ‹
```bash
# PM2 æ—¥å¿—
pm2 logs

# Nginx æ—¥å¿—
tail -f /var/log/nginx/access.log
tail -f /var/log/nginx/error.log

# ç³»ç»Ÿæ—¥å¿—
journalctl -u mysql
journalctl -u redis
```

## ğŸ”’ å®‰å…¨é…ç½®

### SSL è¯ä¹¦ (Let's Encrypt)
```bash
# å®‰è£… Certbot
sudo apt install certbot python3-certbot-nginx

# è·å–è¯ä¹¦
sudo certbot --nginx -d your-domain.com

# è‡ªåŠ¨ç»­æœŸ
sudo crontab -e
# æ·»åŠ : 0 12 * * * /usr/bin/certbot renew --quiet
```

### é˜²ç«å¢™é…ç½®
```bash
# UFW é…ç½®
sudo ufw allow 22/tcp   # SSH
sudo ufw allow 80/tcp   # HTTP
sudo ufw allow 443/tcp  # HTTPS
sudo ufw enable
```

## ğŸ“Š ç›‘æ§å’Œç»´æŠ¤

### æ€§èƒ½ç›‘æ§
```bash
# ç³»ç»Ÿèµ„æº
htop
df -h
free -m

# åº”ç”¨çŠ¶æ€
pm2 monit
```

### å®šæœŸå¤‡ä»½
```bash
# åˆ›å»ºå¤‡ä»½è„šæœ¬
cat > /usr/local/bin/campus-wall-backup.sh << 'EOF'
#!/bin/bash
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_DIR="/var/backups/campus-wall"
mkdir -p $BACKUP_DIR

# å¤‡ä»½æ•°æ®åº“
mysqldump -u campus_wall -p campus_community > "$BACKUP_DIR/db_$DATE.sql"

# å¤‡ä»½æ–‡ä»¶
tar -czf "$BACKUP_DIR/files_$DATE.tar.gz" /var/www/campus-wall/server/uploads

# æ¸…ç†7å¤©å‰çš„å¤‡ä»½
find $BACKUP_DIR -mtime +7 -delete
EOF

chmod +x /usr/local/bin/campus-wall-backup.sh

# è®¾ç½®å®šæ—¶ä»»åŠ¡
echo "0 2 * * * /usr/local/bin/campus-wall-backup.sh" | crontab -
```

## ğŸ“± ç§»åŠ¨ç«¯éƒ¨ç½² (å¯é€‰)

### H5 ç‰ˆæœ¬
```bash
cd uni-APP
npm run build:h5
# å°† dist/build/h5 ç›®å½•å†…å®¹å¤åˆ¶åˆ° web æœåŠ¡å™¨
```

### å¾®ä¿¡å°ç¨‹åº
```bash
cd uni-APP
npm run build:mp-weixin
# ä½¿ç”¨å¾®ä¿¡å¼€å‘è€…å·¥å…·æ‰“å¼€ dist/build/mp-weixin ç›®å½•
```

### APP æ‰“åŒ…
```bash
cd uni-APP
npm run build:app-plus
# ä½¿ç”¨ HBuilderX è¿›è¡ŒåŸç”Ÿæ‰“åŒ…
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°éƒ¨ç½²é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. æœåŠ¡å™¨ç³»ç»Ÿç¯å¢ƒæ˜¯å¦æ»¡è¶³è¦æ±‚
2. æ•°æ®åº“è¿æ¥é…ç½®æ˜¯å¦æ­£ç¡®
3. ç«¯å£æ˜¯å¦è¢«å ç”¨æˆ–è¢«é˜²ç«å¢™é˜»æ‹¦
4. æ–‡ä»¶æƒé™æ˜¯å¦æ­£ç¡®è®¾ç½®
5. åŸŸåDNSè§£ææ˜¯å¦æ­£ç¡®

---

**æç¤º**: é¦–æ¬¡éƒ¨ç½²å»ºè®®å…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯ï¼Œç¡®ä¿ä¸€åˆ‡æ­£å¸¸åå†åœ¨ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²ã€‚







