# 审核功能测试指南

## 🧪 测试步骤

### **1. 准备工作**
1. 启动后端服务：`cd server && npm start`
2. 启动管理后台：`cd admin && npm run dev`
3. 启动前端App：`cd uni-APP && npm run dev:h5`

### **2. 配置审核设置**

#### **测试场景1：强制人工审核模式**
1. 登录管理后台 (http://localhost:8888)
2. 进入 **系统设置** → **内容设置**
3. 设置如下：
   ```
   强制人工审核: 开启 ✅
   智能审核模式: 关闭 ❌
   自动通过关键词: 学习,教育
   自动拒绝关键词: 广告,推广
   ```
4. 点击 **保存设置**

#### **测试场景2：智能审核模式**
1. 设置如下：
   ```
   强制人工审核: 关闭 ❌
   智能审核模式: 开启 ✅
   自动通过关键词: 学习,教育,知识
   自动拒绝关键词: 广告,推广,微信
   ```

#### **测试场景3：完全开放模式**
1. 设置如下：
   ```
   强制人工审核: 关闭 ❌
   智能审核模式: 关闭 ❌
   自动通过关键词: 学习,教育
   自动拒绝关键词: 广告,推广
   ```

### **3. 测试帖子发布**

#### **强制审核模式测试**
1. 在前端App发布帖子：
   - 标题：`测试帖子`
   - 内容：`这是一个普通的测试内容`
2. **预期结果**：
   - 显示弹窗：`您的内容正在审核中，审核通过后将会显示`
   - 帖子不会立即显示在首页
   - 后台可以看到待审核帖子

#### **智能审核模式测试**

**测试用例1：包含自动通过关键词**
1. 发布帖子：
   - 内容：`我想分享一些学习心得`
2. **预期结果**：
   - 显示：`帖子发布成功`
   - 帖子立即显示在首页

**测试用例2：包含自动拒绝关键词**
1. 发布帖子：
   - 内容：`这是一个广告推广内容`
2. **预期结果**：
   - 显示：`内容包含禁止词汇，无法发布`
   - 帖子不会被创建

**测试用例3：不包含关键词**
1. 发布帖子：
   - 内容：`今天天气不错`
2. **预期结果**：
   - 显示弹窗：`您的内容正在审核中，审核通过后将会显示`
   - 帖子进入审核队列

#### **完全开放模式测试**
1. 发布帖子：
   - 内容：`这是一个普通帖子`
2. **预期结果**：
   - 显示：`帖子发布成功`
   - 帖子立即显示

### **4. 测试评论发布**

#### **强制审核模式**
1. 在任意帖子下发表评论：`这是一条测试评论`
2. **预期结果**：
   - 显示弹窗：`您的评论正在审核中，审核通过后将会显示`
   - 评论不会立即显示

#### **智能审核模式**
1. 发表包含通过关键词的评论：`学习很重要`
   - **预期**：立即显示
2. 发表包含拒绝关键词的评论：`这是广告`
   - **预期**：显示禁止发布提示
3. 发表普通评论：`不错的内容`
   - **预期**：进入审核队列

### **5. 测试管理员审核**

#### **查看待审核内容**
1. 登录管理后台
2. 进入 **内容管理** → **内容审核**
3. 查看待审核的帖子和评论列表

#### **审核操作**
1. **通过审核**：
   - 点击 **通过** 按钮
   - 内容立即显示给用户
2. **拒绝审核**：
   - 点击 **拒绝** 按钮
   - 填写拒绝原因
   - 内容不会显示

### **6. 验证前端显示**

#### **帖子列表**
1. 检查首页帖子列表
2. 确认只显示 `status = 'published'` 的帖子
3. 待审核帖子不应该显示

#### **评论列表**
1. 检查帖子详情页评论
2. 确认只显示 `status = 'normal'` 的评论
3. 待审核评论不应该显示

## 🔍 **测试检查点**

### **后端API检查**
```bash
# 检查帖子状态
curl -X GET "http://localhost:3000/api/posts" | jq '.data.list[].status'

# 检查评论状态  
curl -X GET "http://localhost:3000/api/posts/1/comments" | jq '.data.list[].status'
```

### **数据库检查**
```sql
-- 检查帖子状态分布
SELECT status, COUNT(*) as count FROM posts GROUP BY status;

-- 检查评论状态分布
SELECT status, COUNT(*) as count FROM comments GROUP BY status;

-- 查看待审核内容
SELECT id, title, status, created_at FROM posts WHERE status = 'pending';
SELECT id, content, status, created_at FROM comments WHERE status = 'pending';
```

### **前端控制台检查**
1. 打开浏览器开发者工具
2. 查看网络请求响应
3. 检查是否有审核相关的字段：
   ```javascript
   {
     "needsAudit": true,
     "auditMessage": "您的内容正在审核中，审核通过后将会显示"
   }
   ```

## ✅ **预期结果总结**

### **强制审核模式**
- ✅ 所有内容都进入审核队列
- ✅ 用户看到审核提示
- ✅ 内容不立即显示
- ✅ 管理员可以审核

### **智能审核模式**
- ✅ 包含通过关键词：立即发布
- ✅ 包含拒绝关键词：直接拒绝
- ✅ 无关键词匹配：进入审核队列

### **完全开放模式**
- ✅ 大部分内容立即发布
- ✅ 只有包含拒绝关键词的内容被拒绝

### **用户体验**
- ✅ 发布成功时显示成功提示
- ✅ 需要审核时显示审核提示
- ✅ 被拒绝时显示拒绝原因
- ✅ 前端不显示待审核内容

## 🐛 **常见问题排查**

### **问题1：设置不生效**
- 检查设置是否正确保存到数据库
- 重启后端服务
- 清除浏览器缓存

### **问题2：前端仍显示"发布成功"**
- 检查后端是否正确返回审核状态
- 检查前端是否正确处理响应
- 查看浏览器控制台错误

### **问题3：待审核内容仍然显示**
- 检查查询条件是否正确过滤状态
- 检查数据库中的状态字段
- 重新加载页面

### **问题4：关键词不生效**
- 检查关键词格式（逗号分隔）
- 检查大小写匹配
- 检查关键词是否包含空格

## 📊 **测试报告模板**

```
测试时间：2025-01-25
测试人员：[姓名]
测试环境：开发环境

测试结果：
□ 强制审核模式 - 通过/失败
□ 智能审核模式 - 通过/失败  
□ 完全开放模式 - 通过/失败
□ 帖子审核流程 - 通过/失败
□ 评论审核流程 - 通过/失败
□ 管理员审核操作 - 通过/失败
□ 前端状态显示 - 通过/失败

发现问题：
1. [问题描述]
2. [问题描述]

建议改进：
1. [改进建议]
2. [改进建议]
```

---

**测试完成后，确保所有功能都按预期工作！** 🎉
